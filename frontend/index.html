<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hackathon QA Test Plan Agent (T0)</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header>
    <h1>Hackathon QA Test Plan Agent – T0</h1>
    <p class="muted">Issue Generator (G1/G2) + Xray Preview + Test Plans Governance (G4)</p>
  </header>

  <div class="container">
    <nav class="tabs">
      <button id="tab-issue" class="tab active" onclick="showPanel('issue')">Issue Generator (G1/G2)</button>
      <button id="tab-plans" class="tab" onclick="showPanel('plans')">Test Plans (G4)</button>
    </nav>

    <!-- =========================
         PANEL 1: Issue Generator
         ========================= -->
    <section id="panel-issue" class="panel active">
      <p class="muted">
        Select a User Story (US-xxx), generate suggestions with the LLM, then export the run so G4 can consume it.
      </p>

      <div class="row">
        <div>
          <label for="jiraKeySelect">Jira key:</label>
          <select id="jiraKeySelect"></select>
        </div>

        <div class="btn-row">
          <button onclick="generate()">Generate (LLM)</button>
          <button id="exportBtn" onclick="exportRun()" disabled>Export run (G1/G2 → G4)</button>
          <button onclick="openInspector()">Open Inspector</button>
        </div>
      </div>

      <div id="status"></div>

      <h2>Result (Markdown)</h2>
      <pre id="result"></pre>

      <h2>Suggestions (JSON)</h2>
      <pre id="jsonResult"></pre>
    </section>

    <!-- =========================
         PANEL 2: Test Plans (G4)
         ========================= -->
    <section id="panel-plans" class="panel">
      <p class="muted">
        Browse existing test plans (campaigns). Select an <b>overlay</b> to preview governance without touching baseline.
        <br />
        <b>Run overlays</b> (US-xxx) are computed (read-only, Pattern A). <b>File overlays</b> are G4 governance (persisted).
      </p>

      <div>
        <label for="overlaySelect">Overlay:</label>
        <select id="overlaySelect" onchange="loadTestPlans()">
          <option value="">none</option>
        </select>

        <button onclick="loadTestPlans()">Refresh Plans</button>
      </div>

      <div id="plansStatus" class="muted" style="margin-top:0.75rem;"></div>

      <table>
        <thead>
          <tr>
            <th style="width: 18%;">Plan</th>
            <th>Summary</th>
            <th style="width: 10%;">#Jira</th>
            <th style="width: 10%;">#Tests</th>
            <th style="width: 14%;">Overlay</th>
            <th style="width: 14%;">Action</th>
          </tr>
        </thead>
        <tbody id="plansTbody">
          <tr><td colspan="6" class="muted">Loading...</td></tr>
        </tbody>
      </table>
    </section>
  </div>

  <div id="drawerBackdrop" class="drawer-backdrop" onclick="closeInspector()"></div>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-header">
      <div>
        <div class="drawer-title">Inspector</div>
        <div class="drawer-subtitle">
          Context for: <code id="inspectorKey">—</code>
          <span id="inspectorRole" class="muted" style="margin-left:0.5rem;"></span>
        </div>
      </div>
      <div class="drawer-actions">
        <button onclick="refreshInspector()">Refresh</button>
        <button onclick="closeInspector()">Close</button>
      </div>
    </div>

    <!-- Tabs are role-filtered by JS -->
    <div class="drawer-tabs" id="drawerTabs">
      <button id="tabJiraBtn" class="tab-btn active" data-tab="jira" onclick="setInspectorTab('jira')">Jira</button>
      <button id="tabXrayBtn" class="tab-btn" data-tab="xray" onclick="setInspectorTab('xray')">Xray</button>
      <button id="tabBitbucketBtn" class="tab-btn" data-tab="bitbucket" onclick="setInspectorTab('bitbucket')">Bitbucket</button>
      <button id="tabPromptBtn" class="tab-btn" data-tab="prompt" onclick="setInspectorTab('prompt')">Prompt</button>
      <button id="tabPlanBtn" class="tab-btn" data-tab="plan" onclick="setInspectorTab('plan')">Plan</button>
    </div>

    <div class="drawer-body">
      <div class="viewer-toolbar">
        <!-- Overlay selector is only meaningful for G4 / plan mode.
             In G1/G2 mode we either hide it or show only the run for the current US. -->
        <span id="drawerOverlayWrap">
          <select id="drawerOverlaySelect" onchange="onDrawerOverlayChange()">
            <option value="">Overlay: none</option>
          </select>
        </span>

        <button id="enrichBtn" onclick="enrichCurrentPlan()" style="display:none;">Enrich (G4)</button>
        <button id="copyBtn" onclick="copyInspector()">Copy</button>
      </div>

      <pre id="inspectorContent" class="viewer-pre">Open the inspector to load data.</pre>
    </div>
  </aside>

  <script src="/app.js"></script>
</body>
</html>
